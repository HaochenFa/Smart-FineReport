# v1.0.x-vision 视觉分析版本说明

## 背景

在项目初期，我们尝试通过解析帆软报表的结构化数据来实现 AI 分析，但实践中发现该方案存在诸多挑战：

- **组件命名不规范**：帆软报表中的组件（Widget）命名混乱，难以稳定地抓取特定数据。
- **数据结构复杂**：不同类型的图表返回的数据格式各异，数据清洗和格式化的工作量巨大且难以维护。
- **前端暴露敏感信息**：将 vLLM API 的通信逻辑和密钥直接置于前端，存在安全风险。

为了应对这些挑战，并实现快速、稳定地上线，我们决定调整技术路线，推出 `v1.0.x-vision` 版本。

## 版本目标

`v1.0.x-vision` 版本的核心目标是：

- **快速上线**：简化数据处理流程，优先保障核心功能的可用性。
- **高稳定性**：规避因报表结构变动或命名不规范导致的数据抓取失败问题。
- **良好的用户体验**：提供一个直观、易于操作的 AI 分析交互界面。

## 技术路线

新版本将采用以视觉为核心的分析方案：

1.  **截图替代数据抓取**：不再直接解析帆软报表的底层数据，而是通过 `html2canvas` 等库将报表界面整体或局部渲染成一张图片。
2.  **多模态大模型分析**：将用户提问和报表截图一同发送给部署在 vLLM 上的多模态大语言模型（如 LLaVA）。模型将直接“看到”报表内容，并结合用户问题进行分析和回答。
3.  **BFF 后端服务**：创建一个后端代理服务（BFF），负责管理 API 密钥和与 vLLM 服务的通信，确保前端的安全性。

## 开发计划

- [x] **前端改造**：集成 `html2canvas`，实现报表截图功能。
- [x] **核心逻辑重构**：调整 `PromptBuilder` 和 `AIEngine`，以支持多模态请求（文本 + 图片）。
- [x] **测试用例更新**：重写单元测试和集成测试，以验证新的视觉分析流程。
- [ ] **BFF 后端服务**：开发一个简单的 Node.js 代理，用于转发请求和管理密钥。
- [ ] **UI 优化**：设计一个通用的、能够适配不同面板的 AI 对话界面。