# ğŸ¤– æ™ºå¸†æŠ¥è¡¨ (Smart FineReport Dashboard)

ä¸€ä¸ªé›†æˆ AI åˆ†æåŠŸèƒ½çš„å¸†è½¯æŠ¥è¡¨ (FineReport) æ¡†æ¶ã€‚è¯¥é¡¹ç›®å½“å‰ç‰ˆæœ¬ä¸º v1.0.0-visionï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šé€šè¿‡æ•è·æŠ¥è¡¨ç•Œé¢çš„æˆªå›¾ï¼Œå¹¶å°†å…¶å‘é€ç»™å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹ï¼ˆvLLM
éƒ¨ç½²ï¼‰ï¼Œä»è€Œå®ç°å¯¹æŠ¥è¡¨æ•°æ®çš„æ™ºèƒ½åˆ†æã€‚

## æ ¸å¿ƒåŠŸèƒ½

- ğŸ“¸ **æˆªå›¾åˆ†æ**ï¼šé€šè¿‡ `html2canvas` ç­‰æŠ€æœ¯å°†å½“å‰æŠ¥è¡¨è§†å›¾æ¸²æŸ“ä¸ºå›¾ç‰‡ï¼Œå¹¶å°†å…¶ä½œä¸ºæ ¸å¿ƒåˆ†æä¾æ®ã€‚
- ğŸ¤– **å¤šæ¨¡æ€å¯¹è¯**ï¼šå°†ç”¨æˆ·æé—®å’ŒæŠ¥è¡¨æˆªå›¾ä¸€åŒå‘é€ç»™å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼Œç”ŸæˆåŒ…å«æ€»ç»“ã€æ´å¯Ÿå’Œå»ºè®®çš„åˆ†ææŠ¥å‘Šã€‚
- ğŸ’¬ **å¤šè½®æ¬¡äº¤äº’**ï¼šæ”¯æŒç”¨æˆ·å›´ç»•æŠ¥è¡¨æˆªå›¾å’Œç”Ÿæˆçš„åˆ†ææŠ¥å‘Šï¼Œä¸ AI è¿›è¡Œå¤šè½®æ¬¡çš„è¿½é—®å’Œæ¢è®¨ã€‚

## éƒ¨ç½²æ–¹å¼

- åœ¨å¸†è½¯ (FineReport) ä¸­å®šä¹‰ä¸€ä¸ªã€ŒæŒ‰é’®äº‹ä»¶ Button Eventã€ï¼Œæˆ–è€…åœ¨ HTML æ¡†æ¶ä¸­åˆ›å»º `<scripts> </scripts>`
- ä½¿ç”¨ rollup å·¥å…·å°†é¡¹ç›®æ–‡ä»¶æ‰“åŒ…æˆå•ä¸€çš„ JS æ–‡ä»¶
- åœ¨æŒ‰é’®äº‹ä»¶æˆ– `<script></script>` ä»£ç å—ä¸­å¯¼å…¥ JS æ–‡ä»¶

### ç¯å¢ƒå˜é‡é…ç½®

ä¸ºäº†å¢å¼ºå®‰å…¨æ€§ï¼ŒBFF (Backend for Frontend) æœåŠ¡æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æ¥é…ç½® API KEYã€‚æ‚¨å¯ä»¥åœ¨ `bff/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `.env`
æ–‡ä»¶ï¼Œå¹¶æŒ‰ä»¥ä¸‹æ ¼å¼æ·»åŠ æ‚¨çš„ API KEYï¼š

```plaintext
LLM_API_KEYS=your_api_key_1,your_api_key_2
LLM_FALLBACK_URLS=http://127.0.0.1:8080,http://127.0.0.1:8081
```

- `LLM_API_KEYS`ï¼šä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„ API KEY åˆ—è¡¨ã€‚BFF æœåŠ¡ä¼šæ ¹æ® `LLM_FALLBACK_URLS` çš„é¡ºåºï¼Œä¸ºæ¯ä¸ªè¯·æ±‚é™„åŠ å¯¹åº”çš„ KEYã€‚
- `LLM_FALLBACK_URLS`ï¼šä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„ vLLM æœåŠ¡ URL åˆ—è¡¨ã€‚BFF æœåŠ¡ä¼šæŒ‰é¡ºåºå°è¯•è¿æ¥ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚

## é¡¹ç›®æ¶æ„

### æ¶æ„è®¾è®¡

[//]: # "```mermaid"

[//]: # "flowchart BT"

[//]: # "    id0[BFF åç«¯ä»£ç†æœåŠ¡]"

[//]: # "    id1[Utils å·¥å…·ä¸é…ç½®]"

[//]: # "    id2[Services é€šç”¨æœåŠ¡]"

[//]: # "    id3[Integration å¸†è½¯é›†æˆ]"

[//]: # "    id4[Core æ ¸å¿ƒ AI é€»è¾‘]"

[//]: # "    id5[UI ç•Œé¢]"

[//]: # "    id6[App åº”ç”¨æ§åˆ¶]"

[//]: # "    id7[Entry Point æ¨¡å—å…¥å£]"

[//]: # "    id0 --> id2"

[//]: # "    id1 --> id2"

[//]: # "    id2 --> id3 --> id4 --> id5 --> id6 --> id7"

[//]: # "```"

```mermaid
flowchart BT
    subgraph "External Service å¤–éƒ¨æœåŠ¡"
        id0((BFF åç«¯ä»£ç†æœåŠ¡))
        id_vLLM((vLLM æœåŠ¡))
    end

    subgraph "Frontend Application å‰ç«¯åº”ç”¨"
        id1[Utils å·¥å…·ä¸é…ç½®]
        id2[Services é€šç”¨æœåŠ¡]
        id3[Integration å¸†è½¯é›†æˆ]
        id4[Core æ ¸å¿ƒ AI é€»è¾‘]
        id5[UI ç•Œé¢]
        id6[App åº”ç”¨æ§åˆ¶]
        id7[Entry Point æ¨¡å—å…¥å£]
    end

%% ä¾èµ–å…³ç³»ä¸è¯·æ±‚æµ (å®çº¿)
    id2 -- " API Request å‘èµ·APIè¯·æ±‚ " --> id0
    id1 --> id2
    id1 --> id3
    id1 --> id4
    id1 --> id6
    id2 --> id4
    id3 --> id4
    id4 --> id6
    id5 --> id6
    id6 --> id7
    id0 -- " Forward & Authenticate è½¬å‘å¹¶é‰´æƒ " --> id_vLLM
%% å“åº”æµ (è™šçº¿)
    id_vLLM -.->|" è¿”å›AIç»“æœ "| id0
    id0 -.->|" è¿”å›ç»™å‰ç«¯ "| id2
```

### æ–‡ä»¶ç»“æ„

```plaintext
/SmartFineReport
â”œâ”€â”€ src/                # Source files
â”‚   â”œâ”€â”€ main.js             # The Main Entrance
â”‚   â”œâ”€â”€ app/            # Application control and initialization
â”‚   â”‚    â”œâ”€â”€ app-controller.js        # Core service
â”‚   â”‚    â””â”€â”€ state-manager.js         # UI <-> Backend bridging
â”‚   â”œâ”€â”€ core/           # Core AI and analysis logic
â”‚   â”‚    â”œâ”€â”€ ai-analysis-pipeline.js  # AI service controller
â”‚   â”‚    â”œâ”€â”€ context-manager.js       # Manage context (conversation)
â”‚   â”‚    â”œâ”€â”€ vllm-interface.js        # Connect to vLLM service
â”‚   â”‚    â””â”€â”€ prompt-builder.js        # Build structured prompts
â”‚   â”œâ”€â”€ integration/    # FineReport integration (v1.5.x)
â”‚   â”‚    â”œâ”€â”€ data-processor.js        # (v1.5.x) Organize and clean raw data
â”‚   â”‚    â””â”€â”€ fr-interface.js          # (v1.5.x) Fetch FR data
â”‚   â”œâ”€â”€ services/       # Common services
â”‚   â”‚    â””â”€â”€ api-service.js           # General API service wrapper
â”‚   â”œâ”€â”€ ui/             # User interface components
â”‚   â”‚    â”œâ”€â”€ chat-view.js             # Basic chat window implementation
â”‚   â”‚    â””â”€â”€ ui-manager.js            # Control UI status
â”‚   â””â”€â”€ utils/          # Utility functions and configs
â”‚        â”œâ”€â”€ default-prompt.js        # Prompt template
â”‚        â”œâ”€â”€ logger.js                # Logger
â”‚        â””â”€â”€ settings.js              # Static config and secrets
â”‚
â””â”€â”€tests/               # Test files
    â”œâ”€â”€ e2e/            # E2E tests
    â””â”€â”€ integration/    # Integration tests
         â””â”€â”€ full-analysis-flow.test.js # Statndard path integration test
```

## å¼€å‘è®¡åˆ’

é¡¹ç›®å½“å‰å¤„äº `v1.0.0-vision-alpha` é˜¶æ®µï¼Œæ ¸å¿ƒçš„è§†è§‰åˆ†æåŠŸèƒ½å·²å¼€å‘å®Œæˆã€‚åç»­è®¡åˆ’å°†èšç„¦äºç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒæå‡ï¼Œç›´è‡³æ­£å¼ä¸Šçº¿ã€‚

### v1.0: è§†è§‰åˆ†ææ ¸å¿ƒ (å·²å®Œæˆ)

-   [x] **æ ¸å¿ƒæ¡†æ¶**: å®Œæˆäº†åŸºäºæˆªå›¾å’Œå¤šæ¨¡æ€æ¨¡å‹çš„ AI åˆ†ææµç¨‹ã€‚
-   [x] **å‰ç«¯ç•Œé¢**: å¼€å‘äº†å¯åµŒå…¥çš„ã€ç”±çŠ¶æ€é©±åŠ¨çš„èŠå¤© UI ç»„ä»¶ã€‚
-   [x] **åç«¯ä»£ç† (BFF)**: å»ºç«‹äº†ç”¨äº API å¯†é’¥ç®¡ç†å’Œå®‰å…¨è¯·æ±‚è½¬å‘çš„ BFF æœåŠ¡ã€‚
-   [x] **æ„å»ºä¸æ ·å¼**: é›†æˆäº† Rollup æ‰“åŒ…æµç¨‹å’Œ Tailwind CSSï¼Œå¹¶è§£å†³äº†æ ·å¼éš”ç¦»é—®é¢˜ã€‚
-   [x] **æ ¸å¿ƒé€»è¾‘æµ‹è¯•**: ç¼–å†™äº†è¦†ç›–æ ¸å¿ƒæ¨¡å—çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚

### åç»­è®¡åˆ’

-   [ ] **ç¯å¢ƒéƒ¨ç½²ä¸æµ‹è¯•**:
    -   [ ] éƒ¨ç½²åˆ°å†…éƒ¨æµ‹è¯•ç¯å¢ƒï¼Œè¿›è¡Œå…¨é¢çš„åŠŸèƒ½éªŒè¯ã€‚
    -   [ ] éƒ¨ç½²åˆ°é¢„ç”Ÿäº§ç¯å¢ƒï¼Œä¸çœŸå®çš„å¸†è½¯çœ‹æ¿è¿›è¡Œé›†æˆæµ‹è¯•ã€‚
-   [x] **UI/UX ä¼˜åŒ–**:
    -   [x] æ ¹æ®æµ‹è¯•åé¦ˆï¼Œè¿›ä¸€æ­¥ä¼˜åŒ– UI å¸ƒå±€å’Œäº¤äº’ç»†èŠ‚ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
    -   [x] å¢å¼º UI å¯¹ä¸åŒå°ºå¯¸çœ‹æ¿å’Œå±å¹•çš„å“åº”å¼é€‚é…èƒ½åŠ›ã€‚
-   [ ] **ç«¯åˆ°ç«¯ (E2E) æµ‹è¯•**: ç¼–å†™è‡ªåŠ¨åŒ– E2E æµ‹è¯•ç”¨ä¾‹ï¼Œæ¨¡æ‹Ÿç”¨æˆ·ä»ç‚¹å‡»æŒ‰é’®åˆ°è·å–åˆ†æç»“æœçš„å®Œæ•´æµç¨‹ã€‚
-   [ ] **æ–‡æ¡£å®Œå–„**: æ›´æ–°å’Œå®Œå–„æœ€ç»ˆç”¨æˆ·ä½¿ç”¨æ‰‹å†Œå’Œå¼€å‘è€…æ–‡æ¡£ã€‚
-   [ ] **æ­£å¼ä¸Šçº¿**: åœ¨å®Œæˆæ‰€æœ‰æµ‹è¯•å’Œä¼˜åŒ–åï¼Œæ­£å¼å‘å¸ƒ v1.0.0 ç‰ˆæœ¬ã€‚

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

é¡¹ç›®çš„éƒ¨ç½²åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼šéƒ¨ç½²åç«¯ BFF æœåŠ¡ã€æ„å»ºå‰ç«¯è„šæœ¬ã€åœ¨å¸†è½¯ä¸­é›†æˆã€‚

### æ­¥éª¤ 1: éƒ¨ç½² BFF åç«¯æœåŠ¡

BFF (Backend for Frontend) æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Node.js æœåŠ¡ï¼Œè´Ÿè´£å®‰å…¨åœ°ç®¡ç† API å¯†é’¥å’Œä»£ç†è¯·æ±‚ã€‚**å¿…é¡»å°†å…¶éƒ¨ç½²åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­**ã€‚

1. **ä¸Šä¼ æ–‡ä»¶**: å°†é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `bff/` æ–‡ä»¶å¤¹å®Œæ•´ä¸Šä¼ åˆ°æ‚¨çš„æœåŠ¡å™¨ã€‚
2. **é…ç½®ç¯å¢ƒå˜é‡**: è¿›å…¥æœåŠ¡å™¨çš„ `bff/` ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ª `.env` æ–‡ä»¶ï¼Œå¹¶é…ç½®ä»¥ä¸‹å˜é‡ï¼š
   ```plaintext
   # .env
   LLM_API_KEYS=your_api_key_1,your_api_key_2
   LLM_FALLBACK_URLS=http://vllm-service-1.com,http://vllm-service-2.com
   ```
3. **å®‰è£…ä¾èµ–**: åœ¨æœåŠ¡å™¨çš„ `bff/` ç›®å½•ä¸­æ‰§è¡Œï¼š
   ```bash
   npm install
   ```
4. **å¯åŠ¨æœåŠ¡**: ä¸ºäº†ä¿è¯æœåŠ¡ç¨³å®šæ€§ï¼Œæ¨èä½¿ç”¨è¿›ç¨‹å®ˆæŠ¤å·¥å…· `pm2`ã€‚
   ```bash
   # å…¨å±€å®‰è£… pm2 (å¦‚æœå°šæœªå®‰è£…)
   npm install -g pm2

   # ä½¿ç”¨ pm2 å¯åŠ¨æœåŠ¡
   pm2 start index.js --name "smart-finereport-bff"
   ```
   è¯·ç¡®ä¿ BFF æœåŠ¡æ‰€åœ¨çš„ç«¯å£ï¼ˆé»˜è®¤ä¸º 3001ï¼‰å·²åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾ï¼Œå¹¶è®°å½•ä¸‹å…¶è®¿é—®åœ°å€ï¼Œä¾‹å¦‚ `http://your-server-ip:3001`ã€‚

### æ­¥éª¤ 2: æ„å»ºå‰ç«¯è„šæœ¬

åœ¨æ‚¨çš„**æœ¬åœ°å¼€å‘ç¯å¢ƒ**ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚

1. **é…ç½® BFF åœ°å€**: æ‰“å¼€ `src/utils/settings.js` æ–‡ä»¶ï¼Œä¿®æ”¹ `SETTINGS.service.url` çš„å€¼ï¼Œä½¿å…¶æŒ‡å‘æ‚¨åœ¨ä¸Šä¸€æ­¥ä¸­éƒ¨ç½²çš„ BFF
   æœåŠ¡åœ°å€ã€‚
2. **æ‰§è¡Œæ„å»º**: åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œæ‰“åŒ…å‘½ä»¤ï¼š
   ```bash
   npm run build
   ```
3. **è·å–äº§ç‰©**: æ„å»ºæˆåŠŸåï¼Œåœ¨ `dist/` ç›®å½•ä¸‹æ‰¾åˆ° `smart-finereport.umd.js` æ–‡ä»¶ã€‚å°†æ­¤æ–‡ä»¶ä¸Šä¼ åˆ° CDN æˆ–å¸†è½¯æœåŠ¡å™¨çš„é™æ€èµ„æºç›®å½•ï¼Œç¡®ä¿èƒ½é€šè¿‡
   URL å…¬å¼€è®¿é—®ã€‚

### æ­¥éª¤ 3: åœ¨å¸†è½¯ä¸­é›†æˆ

1. **æ·»åŠ å®¹å™¨**: åœ¨å¸†è½¯çœ‹æ¿è®¾è®¡å™¨ä¸­ï¼Œæ‹–å…¥ä¸€ä¸ª HTML ç»„ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ä»¥åˆ›å»ºæŒ‚è½½ç‚¹ã€‚èŠå¤©çª—å£å°†åœ¨æ­¤æ¸²æŸ“ã€‚
   ```html
   <div id="smartfine-chat-container"></div>
   ```
2. **æ·»åŠ æŒ‰é’®**: åœ¨çœ‹æ¿ä¸Šæ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œç”¨äºè§¦å‘ AI åˆ†æåŠ©æ‰‹ã€‚
3. **é…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶**: ä¸ºè¯¥æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹ JavaScript ä»£ç ã€‚è¿™æ˜¯æ¨èçš„åŠ¨æ€åŠ è½½æ–¹å¼ï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚

   ```javascript
   // è¯·å°† scriptUrl æ›¿æ¢ä¸ºæ‚¨åœ¨æ­¥éª¤ 2 ä¸­ä¸Šä¼ çš„ JS æ–‡ä»¶åœ°å€
   const scriptUrl = 'https://your-cdn.com/path/to/smart-finereport.umd.js';

   // æ£€æŸ¥è„šæœ¬æ˜¯å¦å·²åŠ è½½ï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œ
   if (window.initAIAssistant) {
     window.initAIAssistant({
       containerSelector: '#smartfine-chat-container',
       fineReportInstance: _g() // _g() æˆ– FR æ˜¯å¸†è½¯çš„å…¨å±€å¯¹è±¡ï¼Œè¯·æŒ‰éœ€ä¼ å…¥
     });
   } else {
     const script = document.createElement('script');
     script.src = scriptUrl;
     script.onload = function() {
       window.initAIAssistant({
         containerSelector: '#smartfine-chat-container',
         fineReportInstance: _g()
       });
     };
     document.head.appendChild(script);
   }
   ```

## å¼€å‘è°ƒè¯•

- å®‰è£…ä¾èµ–ï¼š

```bash
cd SmartFineReport/ &&
npm install
```

- è¿è¡Œæµ‹è¯•ï¼š

```bash
npm test
```
